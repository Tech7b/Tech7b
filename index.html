<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Configurador T√©cnico | Tech 7B</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- VARI√ÅVEIS DE SISTEMA (GLASSMORPHISM 2.0) --- */
        :root {
            --bg-body: #050505;
            --bg-panel: rgba(20, 20, 20, 0.6);
            --bg-card: rgba(30, 30, 30, 0.4);
            
            --primary: #00ff9d;       /* Verde Neon Principal */
            --primary-dim: rgba(0, 255, 157, 0.1);
            
            --software: #00d9ff;      /* Azul */
            --hardware: #ff9d00;      /* Laranja */
            --dream: #9d4edd;         /* Roxo */
            --danger: #ff4444;        /* Vermelho */
            
            --text-main: #ffffff;
            --text-muted: #a0a0a0;
            --border: rgba(255, 255, 255, 0.08);
            
            /* Glows mais refinados */
            --glow-soft: 0 8px 32px rgba(0, 217, 255, 0.15);
            --glow-hard: 0 8px 32px rgba(255, 157, 0, 0.15);
            --backdrop: blur(12px);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            /* Grid de fundo sutil estilo "Blueprint" */
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            min-height: 100vh;
            padding-bottom: 50px;
        }

        /* --- TRUST BAR --- */
        .trust-bar {
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid var(--border);
            padding: 8px 0;
            font-size: 0.75rem;
            color: var(--text-muted);
            text-align: center;
        }
        .trust-content {
            max-width: 1100px; margin: 0 auto;
            display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;
        }
        .trust-item { display: flex; align-items: center; gap: 5px; }
        .trust-item span { color: var(--primary); }

        /* --- CABE√áALHO --- */
        header {
            background: rgba(5, 5, 5, 0.85);
            backdrop-filter: var(--backdrop);
            border-bottom: 1px solid var(--border);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .brand { font-size: 1.5rem; font-weight: 900; letter-spacing: -1px; text-transform: uppercase; }
        .brand span { color: var(--primary); text-shadow: 0 0 15px rgba(0, 255, 157, 0.4); }

        .global-counter {
            font-size: 0.75rem; background: var(--primary-dim); color: var(--primary);
            padding: 5px 12px; border-radius: 20px; border: 1px solid rgba(0, 255, 157, 0.3);
            display: flex; align-items: center; gap: 6px; font-weight: 700;
            opacity: 0; transition: opacity 1s; animation: fadeIn 2s forwards;
        }

        /* --- PROGRESS BAR (AGORA 4 PASSOS) --- */
        .progress-container {
            display: flex; justify-content: space-between; align-items: center; 
            margin: 30px auto 10px; max-width: 500px; /* Aumentei um pouco */
            position: relative; padding: 0 10px;
        }
        .progress-track {
            position: absolute; top: 15px; left: 34px; right: 34px; height: 3px; background: #222; z-index: 1;
            overflow: hidden; 
            border-radius: 4px;
        }
        .progress-fill {
            height: 100%; background: var(--primary); width: 0%; transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--primary);
        }

        .step {
            display: flex; flex-direction: column; align-items: center; position: relative; z-index: 2; width: 80px;
        }
        .step-circle {
            width: 32px; height: 32px; border-radius: 50%; background: #111; border: 2px solid #444;
            color: #888; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 0.9rem;
            transition: 0.4s;
        }
        .step-label { font-size: 0.7rem; color: #666; margin-top: 8px; font-weight: 600; transition: 0.4s; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .step.active .step-circle { border-color: var(--primary); background: #050505; color: var(--primary); box-shadow: 0 0 15px var(--primary-dim); }
        .step.active .step-label { color: var(--text-main); }
        
        .step.completed .step-circle { background: var(--primary); border-color: var(--primary); color: black; }
        .step.completed .step-label { color: var(--primary); }


        /* --- INPUTS REFINADOS --- */
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; color: var(--text-muted); margin-bottom: 8px; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        input, textarea, select {
            width: 100%; padding: 16px; background: rgba(0,0,0,0.3); border: 1px solid var(--border);
            border-radius: 12px; color: white; font-size: 1rem; transition: 0.3s;
            backdrop-filter: blur(5px);
        }
        input:focus, textarea:focus, select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 2px var(--primary-dim); background: rgba(0,0,0,0.5); }

        /* --- TELAS (STEPS) --- */
        #step-identity, #step-menu, #step-schedule, #step-review {
            animation: fadeInUp 0.5s ease;
        }

        /* NOVO LAYOUT DE IDENTIDADE (2 COLUNAS) */
        #step-identity {
            max-width: 900px; /* Mais largo para caber as 2 colunas */
            margin: 40px auto;
            display: flex;
            gap: 20px;
            align-items: stretch;
        }
        
        @media (max-width: 768px) {
            #step-identity { flex-direction: column; max-width: 480px; }
        }

        .identity-col {
            flex: 1;
            padding: 40px; 
            border-radius: 20px; 
            border: 1px solid var(--border);
            backdrop-filter: var(--backdrop);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* Coluna da Esquerda (Avisos) */
        .info-side {
            background: linear-gradient(145deg, rgba(0, 255, 157, 0.05) 0%, rgba(20,20,20,0.8) 100%);
            border: 1px solid rgba(0, 255, 157, 0.3);
            display: flex; flex-direction: column; justify-content: center;
        }
        
        .info-title {
            color: var(--primary); font-size: 1.5rem; font-weight: 900; 
            margin-bottom: 20px; text-transform: uppercase; letter-spacing: -0.5px;
            display: flex; align-items: center; gap: 10px;
        }

        .info-list {
            list-style: none;
            display: flex; flex-direction: column; gap: 20px;
        }
        .info-item { display: flex; gap: 15px; align-items: flex-start; }
        .info-icon { 
            font-size: 1.5rem; background: rgba(0,255,157,0.1); 
            width: 40px; height: 40px; border-radius: 50%; display: flex; 
            align-items: center; justify-content: center; flex-shrink: 0;
            border: 1px solid rgba(0,255,157,0.2);
        }
        .info-text h4 { color: white; font-weight: 700; margin-bottom: 4px; font-size: 1rem; }
        .info-text p { color: #aaa; font-size: 0.85rem; line-height: 1.4; }


        /* Coluna da Direita (Login) */
        .login-side {
            background: var(--bg-panel);
        }

        .privacy-note { font-size: 0.75rem; color: #555; text-align: center; margin-top: 15px; line-height: 1.4; }

        /* --- MENU --- */
        #step-menu { display: none; padding-bottom: 40px; }

        .main-group-title {
            font-size: 1.8rem; font-weight: 900; text-transform: uppercase; letter-spacing: -1px;
            margin-top: 50px; margin-bottom: 25px; display: flex; align-items: center; gap: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px;
        }
        .sw-title { color: var(--software); text-shadow: 0 0 20px rgba(0, 217, 255, 0.3); }
        .hw-title { color: var(--hardware); text-shadow: 0 0 20px rgba(255, 157, 0, 0.3); }

        .sub-group-container {
            background: linear-gradient(145deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
            border: 1px solid var(--border);
            border-radius: 16px; padding: 25px; margin-bottom: 30px; position: relative;
        }
        .sub-group-header {
            font-size: 1.1rem; font-weight: 700; color: var(--text-main);
            margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; gap: 10px;
        }
        .group-counter { font-size: 0.75rem; background: rgba(0,0,0,0.4); padding: 4px 10px; border-radius: 6px; color: #888; border: 1px solid rgba(255,255,255,0.05); }

        .services-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }

        /* --- CARDS REFINADOS --- */
        .service-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: 12px; padding: 20px; cursor: pointer;
            transition: all 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94); position: relative; overflow: hidden;
            display: flex; flex-direction: column; justify-content: space-between;
            min-height: 150px;
            backdrop-filter: blur(5px);
        }
        .service-card:active { transform: scale(0.97); }
        @media (hover: hover) {
            .service-card:hover { transform: translateY(-5px); border-color: rgba(255,255,255,0.2); }
        }

        .sw-card:hover { box-shadow: var(--glow-soft); border-color: var(--software); }
        .sw-card.selected { background: rgba(0, 217, 255, 0.08); border-color: var(--software); box-shadow: inset 0 0 20px rgba(0, 217, 255, 0.05); }

        .hw-card:hover { box-shadow: var(--glow-hard); border-color: var(--hardware); }
        .hw-card.selected { background: rgba(255, 157, 0, 0.08); border-color: var(--hardware); box-shadow: inset 0 0 20px rgba(255, 157, 0, 0.05); }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .service-name { font-weight: 700; font-size: 1rem; line-height: 1.3; color: #eee; }

        .price-container { display: flex; align-items: baseline; gap: 8px; flex-wrap: wrap; }
        .price-tag { font-size: 1.25rem; font-weight: 800; color: #fff; letter-spacing: -0.5px; }
        .old-price { font-size: 0.85rem; text-decoration: line-through; color: #666; font-weight: 500; }

        .check-circle {
            width: 22px; height: 22px; border-radius: 50%; border: 2px solid #444;
            position: relative; flex-shrink: 0; margin-left: 10px; transition: 0.3s;
        }
        .selected .check-circle { background: var(--primary); border-color: var(--primary); box-shadow: 0 0 10px var(--primary); }
        .selected .check-circle::after {
            content: '‚úì'; color: black; font-size: 14px; font-weight: 900;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

        .badge {
            font-size: 0.65rem; text-transform: uppercase; font-weight: 800; letter-spacing: 0.5px;
            padding: 4px 8px; border-radius: 4px; display: inline-block; margin-top: 10px;
        }
        .bg-sw { background: rgba(0, 217, 255, 0.15); color: var(--software); border: 1px solid rgba(0, 217, 255, 0.2); }
        .bg-hw { background: rgba(255, 157, 0, 0.15); color: var(--hardware); border: 1px solid rgba(255, 157, 0, 0.2); }
        .bg-limitada { background: rgba(255, 68, 68, 0.15); color: var(--danger); border: 1px solid var(--danger); }

        .card-actions { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
        .demo-badge { 
            font-size: 0.7rem; padding: 5px 12px; border-radius: 20px; display: inline-flex; align-items: center; gap: 5px; cursor: pointer; 
            transition: 0.3s; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #ccc; font-weight: 600;
        }
        .demo-badge:hover { background: white; color: black; border-color: white; transform: translateY(-2px); }

        .real-count-badge { font-size: 0.7rem; color: #666; margin-top: 10px; display: flex; align-items: center; gap: 4px; font-weight: 500; }
        .real-count-badge span { color: var(--primary); font-weight: 700; }
        
        /* --- ESTILOS DO SLIDER DE BACKUP --- */
        .backup-controls {
            margin-top: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .slider-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        /* Custom Range Slider */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
            padding: 0;
            border: none;
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 0 10px var(--primary-dim);
        }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
        }
        
        /* Input num√©rico pequeno */
        .manual-input-wrapper {
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(255,255,255,0.1);
            padding: 4px 8px;
            border-radius: 6px;
            min-width: 75px;
        }
        
        .manual-input-wrapper input {
            width: 40px;
            padding: 0;
            border: none;
            background: transparent;
            text-align: right;
            font-weight: 700;
            color: white;
            height: auto;
        }
        /* Remover setas do input number */
        .manual-input-wrapper input::-webkit-outer-spin-button,
        .manual-input-wrapper input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .manual-input-wrapper span {
            font-size: 0.7rem;
            color: #aaa;
            font-weight: 600;
        }

        /* --- TOAST --- */
        #toast-notification {
            position: fixed; top: 80px; right: 20px; z-index: 4000;
            background: rgba(10, 10, 10, 0.9); border-left: 4px solid var(--primary);
            color: white; padding: 15px 20px; border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); backdrop-filter: blur(10px);
            display: none; animation: slideInRight 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); max-width: 320px;
        }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- BOT√ïES GERAIS --- */
        .btn-primary {
            background: var(--primary); color: #000; border: none; padding: 14px 35px;
            font-weight: 800; border-radius: 30px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.3); transition: 0.3s;
            width: 100%; display: flex; justify-content: center; align-items: center; gap: 10px;
        }
        .btn-primary:hover:not(:disabled) { transform: scale(1.02); box-shadow: 0 0 30px rgba(0, 255, 157, 0.5); }
        .btn-primary:disabled { background: #444; color: #888; box-shadow: none; cursor: not-allowed; }

        .btn-secondary {
            background: rgba(255,255,255,0.05); color: #fff; border: 1px solid rgba(255,255,255,0.1);
            padding: 12px 30px; font-weight: 600; border-radius: 30px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px;
            transition: 0.3s; width: 100%; display: flex; justify-content: center; align-items: center; gap: 10px;
        }
        .btn-secondary:hover { background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); }

        /* --- TELA AGENDA (NOVO) --- */
        #step-schedule { display: none; max-width: 600px; margin: 0 auto; }
        
        .schedule-card {
            background: var(--bg-panel); border: 1px solid var(--border);
            border-radius: 20px; padding: 30px; backdrop-filter: var(--backdrop);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .schedule-title { text-align: center; margin-bottom: 25px; }
        .schedule-title h2 { font-size: 1.5rem; color: white; margin-bottom: 5px; text-transform: uppercase; }
        .schedule-title p { color: #888; font-size: 0.9rem; }

        /* Grade de Dias */
        .days-grid { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; 
            margin-bottom: 20px; 
        }
        @media(max-width: 400px) { .days-grid { grid-template-columns: repeat(3, 1fr); } }

        .day-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px; padding: 12px 5px; text-align: center; cursor: pointer;
            transition: 0.3s; color: #aaa; font-weight: 600; font-size: 0.85rem; user-select: none;
        }
        .day-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        
        .day-btn.selected {
            background: var(--primary); color: #000; border-color: var(--primary);
            box-shadow: 0 0 15px var(--primary-dim); font-weight: 800; transform: translateY(-2px);
        }

        /* --- TELA REVIS√ÉO --- */
        #step-review { display: none; max-width: 600px; margin: 0 auto; }
        
        .review-card {
            background: var(--bg-panel); border: 1px solid var(--border);
            border-radius: 20px; padding: 30px; backdrop-filter: var(--backdrop);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .review-header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
        .review-header h2 { font-size: 1.5rem; color: white; text-transform: uppercase; letter-spacing: -0.5px; }
        .review-header p { color: #888; font-size: 0.9rem; margin-top: 5px; }

        .review-list { margin-bottom: 30px; display: flex; flex-direction: column; gap: 10px; }
        .review-item {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.02); padding: 12px 15px; border-radius: 8px;
            border-left: 3px solid transparent; transition: 0.2s;
        }
        .review-item.type-sw { border-left-color: var(--software); }
        .review-item.type-hw { border-left-color: var(--hardware); }
        .review-item-name { font-size: 0.95rem; color: #ddd; font-weight: 500; }
        .review-item-price { font-size: 0.95rem; color: #fff; font-weight: 700; }
        
        .review-schedule-info {
            background: rgba(0,0,0,0.2); border: 1px dashed rgba(255,255,255,0.15);
            padding: 15px; border-radius: 10px; margin-bottom: 20px; color: #ccc; font-size: 0.9rem;
            display: flex; gap: 10px; align-items: flex-start;
        }
        .review-schedule-info span { color: var(--primary); font-weight: bold; }

        .review-summary { 
            background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; margin-bottom: 30px; 
            border: 1px solid rgba(255,255,255,0.05); text-align: center;
        }
        .summary-label { color: #888; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; font-weight: 700; margin-bottom: 5px; }
        .summary-total { font-size: 2.2rem; color: var(--primary); font-weight: 900; letter-spacing: -1px; text-shadow: 0 0 20px var(--primary-dim); }
        .summary-savings { 
            color: var(--primary); font-size: 0.8rem; background: rgba(0, 255, 157, 0.08); 
            padding: 4px 10px; border-radius: 20px; display: inline-block; margin-top: 5px; font-weight: 600;
        }

        .review-actions { display: flex; flex-direction: column; gap: 15px; }
        
        /* Bot√£o flutuante para ir para revis√£o no menu */
        .floating-forward-area {
            margin-top: 40px; padding: 20px; text-align: center;
            background: linear-gradient(to top, rgba(5,5,5,1) 20%, transparent);
            position: sticky; bottom: 0; z-index: 100; pointer-events: none; /* Para n√£o bloquear cliques atr√°s se transparente */
        }
        .floating-forward-area button { pointer-events: auto; max-width: 400px; margin: 0 auto; }


        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); 
            z-index: 3000; display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(8px); animation: fadeIn 0.3s;
        }
        .modal-content {
            background: #151515; width: 90%; max-width: 500px; padding: 30px; 
            border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); text-align: center; position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.7);
        }
        .modal-close { position: absolute; top: 15px; right: 20px; color: #fff; font-size: 1.5rem; cursor: pointer; opacity: 0.7; }
        .modal-close:hover { opacity: 1; }
        
        /* Anima√ß√µes utilit√°rias */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse-recommend { 0% { box-shadow: 0 0 0 0 rgba(0, 255, 157, 0.7); border-color: var(--primary); } 70% { box-shadow: 0 0 0 10px rgba(0, 255, 157, 0); border-color: var(--primary); } 100% { box-shadow: 0 0 0 0 rgba(0, 255, 157, 0); } }
        .recommended-pulse { animation: pulse-recommend 1.5s infinite; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        /* Checkbox e Especiais */
        .symptom-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .symptom-item {
            background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; cursor: pointer;
            display: flex; align-items: center; justify-content: flex-start; 
            gap: 12px; border: 1px solid transparent; transition: 0.2s; user-select: none;
            text-align: left;
        }
        
        .symptom-item input {
            width: 20px; height: 20px; padding: 0; margin: 0; background: transparent;
            border: none; box-shadow: none; accent-color: var(--danger); cursor: pointer; flex-shrink: 0;
        }
        .symptom-item:hover { border-color: var(--danger); background: rgba(255, 68, 68, 0.1); }
        .symptom-item:has(input:checked) { background: rgba(255, 68, 68, 0.2); border-color: var(--danger); }
        
        .dream-section, .diagnosis-section { border-radius: 16px; padding: 30px; margin-top: 30px; display: none; animation: fadeInUp 0.5s ease; border: 1px solid rgba(255,255,255,0.1); }
        .dream-section { background: linear-gradient(135deg, rgba(20,20,20,0.8) 0%, rgba(30,10,40,0.8) 100%); border-color: var(--dream); }
        .diagnosis-section { background: linear-gradient(135deg, rgba(40,10,10,0.8) 0%, rgba(20,20,20,0.8) 100%); border-color: var(--danger); }

    </style>
</head>
<body>

    <!-- TRUST BAR -->
    <div class="trust-bar">
        <div class="trust-content">
            <div class="trust-item"><span>üõ°Ô∏è</span> Garantia de Servi√ßo</div>
            <div class="trust-item"><span>üë®‚Äçüíª</span> T√©cnicos Certificados</div>
            <div class="trust-item"><span>üîí</span> Dados Seguros</div>
            <div class="trust-item"><span>üöÄ</span> Suporte R√°pido</div>
        </div>
    </div>

    <header>
        <div class="container">
            <div class="header-content">
                <div class="brand">TECH <span>7B</span></div>
                <div class="global-counter" id="global-counter-display">
                    üî• <span id="total-services-count">...</span> servi√ßos realizados
                </div>
            </div>
        </div>
    </header>

    <div id="toast-notification">
        <strong>üí° Dica:</strong> <span id="toast-msg"></span>
    </div>

    <!-- PROGRESS BAR (4 PASSOS) -->
    <div class="progress-container">
        <div class="progress-track">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <div class="step active" id="step-1-indicator">
            <div class="step-circle">1</div>
            <div class="step-label">Dados</div>
        </div>
        <div class="step" id="step-2-indicator">
            <div class="step-circle">2</div>
            <div class="step-label">Config</div>
        </div>
        <!-- NOVO PASSO -->
        <div class="step" id="step-3-indicator">
            <div class="step-circle">3</div>
            <div class="step-label">Agenda</div>
        </div>
        <div class="step" id="step-4-indicator">
            <div class="step-circle">4</div>
            <div class="step-label">Revis√£o</div>
        </div>
    </div>

    <div class="container">
        <!-- STEP 1: IDENTIDADE (AGORA DIVIDIDO) -->
        <div id="step-identity">
            
            <!-- COLUNA DA ESQUERDA: AVISOS E SEGURAN√áA -->
            <div class="identity-col info-side">
                <div class="info-title">
                    <span>üõ°Ô∏è</span> COMO FUNCIONA
                </div>
                <ul class="info-list">
                    <li class="info-item">
                        <div class="info-icon">üí≥</div>
                        <div class="info-text">
                            <h4>Sem Dados Banc√°rios</h4>
                            <p>N√£o precisa informar cart√£o ou CPF agora. √â seguro e sem compromisso.</p>
                        </div>
                    </li>
                    <li class="info-item">
                        <div class="info-icon">üìÖ</div>
                        <div class="info-text">
                            <h4>Apenas Agendamento</h4>
                            <p>Esta ferramenta serve para montarmos o or√ßamento e agendarmos o servi√ßo.</p>
                        </div>
                    </li>
                    <li class="info-item">
                        <div class="info-icon">‚úÖ</div>
                        <div class="info-text">
                            <h4>Pagamento na Entrega</h4>
                            <p>Voc√™ s√≥ paga quando o servi√ßo estiver pronto e o PC em suas m√£os.</p>
                        </div>
                    </li>
                    <li class="info-item">
                        <div class="info-icon">ü§ù</div>
                        <div class="info-text">
                            <h4>Risco Zero</h4>
                            <p>Se n√£o resolvermos o problema, voc√™ n√£o paga absolutamente nada.</p>
                        </div>
                    </li>
                </ul>
            </div>

            <!-- COLUNA DA DIREITA: LOGIN -->
            <div class="identity-col login-side">
                <h2 style="margin-bottom: 10px; color: white; text-align: center;">√Årea do Cliente</h2>
                <p style="text-align:center; color:#888; margin-bottom:30px; font-size:0.9rem;">Identifique-se para iniciar seu atendimento personalizado.</p>
                
                <div class="input-group">
                    <label>Nome Completo</label>
                    <input type="text" id="input-name" placeholder="Como podemos te chamar?" oninput="saveState()">
                </div>
                <div class="input-group">
                    <label>WhatsApp</label>
                    <input type="tel" id="input-phone" placeholder="(XX) XXXXX-XXXX" maxlength="16" oninput="maskPhone(this); saveState()">
                </div>
                <button class="btn-primary" onclick="goToMenu()">INICIAR CONFIGURA√á√ÉO ‚ûî</button>
                <p class="privacy-note">
                    <span style="opacity:0.7">üîí Seus dados s√£o usados apenas para o contato sobre o or√ßamento.</span><br>
                    Ao continuar, voc√™ concorda com o envio via WhatsApp.
                </p>
            </div>
            
        </div>

        <!-- STEP 2: MENU -->
        <div id="step-menu">

            <div class="main-group-title sw-title">üíª GRUPO WINDOWS (SOFTWARE)</div>

            <div class="sub-group-container" style="border-left: 3px solid var(--software);">
                <div class="sub-group-header">
                    <div><span class="sub-icon">üõ†Ô∏è</span> Manuten√ß√£o Essencial</div>
                    <div class="group-counter" id="count-group-manutencao"></div>
                </div>
                <div class="services-grid">
                    <div class="service-card sw-card" data-name="Formata√ß√£o Limpa" data-price="40.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Formata√ß√£o Limpa</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 40,00</div></div>
                        <div class="real-count-badge" id="badge-Formata√ß√£o Limpa"></div>
                    </div>
                    <div class="service-card sw-card" data-name="Ativa√ß√£o Windows" data-price="23.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Ativa√ß√£o Windows (Chave Digital)</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 23,00</div></div>
                        <span class="badge bg-sw">ORIGINAL</span>
                        <div class="real-count-badge" id="badge-Ativa√ß√£o Windows"></div>
                    </div>
                    
                    <!-- NOVO CARD BACKUP DIN√ÇMICO -->
                    <div class="service-card sw-card" id="card-backup" data-name="Backup" data-price="25.00" onclick="toggleItem(this)">
                        <div class="card-header">
                            <span class="service-name">Backup (Pague pelo tamanho)</span>
                            <div class="check-circle"></div>
                        </div>
                        
                        <!-- Controles do Slider -->
                        <div class="backup-controls" onclick="event.stopPropagation()">
                            <div class="slider-row">
                                <input type="range" id="backup-slider" min="0" max="100" step="1" value="50" oninput="updateBackupFromSlider(this.value)">
                                <div class="manual-input-wrapper">
                                    <input type="number" id="backup-manual" value="5.0" step="0.1" min="0" max="10" oninput="updateBackupFromInput(this.value)">
                                    <span>GB</span>
                                </div>
                            </div>
                            <div class="price-container" style="justify-content: flex-end; font-size: 0.9rem;">
                                <span style="color:#aaa; margin-right:5px">Valor:</span>
                                <div class="price-tag" id="backup-price-display" style="font-size:1.1rem">R$ 25,00</div>
                            </div>
                        </div>

                        <div class="real-count-badge" id="badge-Backup"></div>
                    </div>

                    <div class="service-card sw-card" data-name="Instala√ß√£o de Programas" data-price="25.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Instala√ß√£o de Programas</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 25,00</div></div>
                        <div class="real-count-badge" id="badge-Instala√ß√£o de Programas"></div>
                    </div>
                </div>
            </div>

            <div class="sub-group-container" style="border-left: 3px solid var(--software);">
                <div class="sub-group-header">
                    <div><span class="sub-icon">üöÄ</span> Performance & Gamer</div>
                    <div class="group-counter" id="count-group-performance"></div>
                </div>
                <div class="services-grid">
                    <div class="service-card sw-card" data-name="Otimiza√ß√£o Windows" data-price="70.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Otimiza√ß√£o Windows (Debloat)</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 70,00</div></div>
                        <span class="badge bg-sw">MAIS FPS</span>
                        <div class="card-actions"><div class="demo-badge" onclick="openDemo(event, 'fps')">‚ñ∑ Ver Ganho de FPS</div></div>
                        <div class="real-count-badge" id="badge-Otimiza√ß√£o Windows"></div>
                    </div>
                    <div class="service-card sw-card" data-name="Renova√ß√£o Drivers" data-price="45.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Renova√ß√£o Drivers (Update+Limpeza)</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 45,00</div></div>
                        <div class="real-count-badge" id="badge-Renova√ß√£o Drivers"></div>
                    </div>
                    <div class="service-card sw-card" data-name="Update BIOS" data-price="60.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Update BIOS + XMP (B√°sico)</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 60,00</div></div>
                        <div class="real-count-badge" id="badge-Update BIOS"></div>
                    </div>
                    <div class="service-card sw-card" data-name="Overclock" data-price="150.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Overclock & Undervolt</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 150,00</div></div>
                        <span class="badge bg-limitada">‚ö†Ô∏è VAGAS LIMITADAS</span>
                        <div class="real-count-badge" id="badge-Overclock"></div>
                    </div>
                    
                    <!-- COMBO COM PSICOLOGIA DE PRE√áO -->
                    <div class="service-card sw-card" data-name="COMBO GAMER TOTAL" data-price="276.25" data-full-price="325.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">COMBO GAMER TOTAL (Tudo Acima)</span><div class="check-circle"></div></div>
                        <div class="price-container">
                            <span class="old-price">R$ 325,00</span>
                            <div class="price-tag">R$ 276,25</div>
                        </div>
                        <span class="badge bg-sw">‚òÖ MELHOR VALOR</span>
                        <div class="real-count-badge" id="badge-COMBO GAMER TOTAL"></div>
                    </div>
                </div>
            </div>

            <div class="sub-group-container" style="border-left: 3px solid var(--software);">
                <div class="sub-group-header">
                    <div><span class="sub-icon">üéôÔ∏è</span> Studio & Stream</div>
                    <div class="group-counter" id="count-group-studio"></div>
                </div>
                <div class="services-grid">
                    <div class="service-card sw-card" data-name="Config Microfone" data-price="165.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Config. Microfone Pro</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 165,00</div></div>
                        <div class="card-actions"><div class="demo-badge" onclick="openDemo(event, 'mic')">üîä Ouvir Antes/Depois</div></div>
                        <div class="real-count-badge" id="badge-Config Microfone"></div>
                    </div>
                    <div class="service-card sw-card" data-name="Calibra√ß√£o Monitor" data-price="60.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Calibra√ß√£o Monitor</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 70,00</div></div>
                        <div class="card-actions">
                            <div class="demo-badge" onclick="openDemo(event, 'color')">üëÅÔ∏è Ver Cores Reais</div>
                            <div class="demo-badge" onclick="openWarning(event)">‚ö†Ô∏è Ler Aviso</div>
                        </div>
                        <div class="real-count-badge" id="badge-Calibra√ß√£o Monitor"></div>
                    </div>
                     <div class="service-card sw-card" data-name="Config OBS" data-price="50.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Config OBS Studio</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 50,00</div></div>
                        <div class="real-count-badge" id="badge-Config OBS"></div>
                    </div>
                    
                    <!-- COMBO STUDIO COM PRE√áO -->
                    <div class="service-card sw-card" data-name="COMBO STUDIO PRO" data-price="242.25" data-full-price="285.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">COMBO STUDIO PRO</span><div class="check-circle"></div></div>
                        <div class="price-container">
                            <span class="old-price">R$ 285,00</span>
                            <div class="price-tag">R$ 242,25</div>
                        </div>
                        <span class="badge bg-sw">‚òÖ PRO</span>
                        <div class="real-count-badge" id="badge-COMBO STUDIO PRO"></div>
                    </div>
                </div>
            </div>

            <div class="main-group-title hw-title">üîß GRUPO HARDWARE (F√çSICO)</div>

            <div class="sub-group-container" style="border-left: 3px solid var(--hardware);">
                <div class="sub-group-header">
                    <div><span class="sub-icon">üßπ</span> Cuidados & Manuten√ß√£o</div>
                    <div class="group-counter" id="count-group-hardware"></div>
                </div>
                <div class="services-grid">
                    <div class="service-card hw-card" data-name="Limpeza Premium" data-price="120.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Limpeza Premium (c/ Pasta T√©rmica)</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 120,00</div></div>
                        <span class="badge bg-hw">COMPLETO</span>
                        <div class="real-count-badge" id="badge-Limpeza Premium"></div>
                    </div>
                    <div class="service-card hw-card" data-name="Organiza√ß√£o de Cabos" data-price="70.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Organiza√ß√£o de Cabos</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 70,00</div></div>
                        <div class="real-count-badge" id="badge-Organiza√ß√£o de Cabos"></div>
                    </div>
                </div>
            </div>

            <div class="sub-group-container" style="border-left: 3px solid var(--hardware);">
                <div class="sub-group-header">
                    <div><span class="sub-icon">üèóÔ∏è</span> Montagem & T√©cnica</div>
                    <div class="group-counter" id="count-group-montagem"></div>
                </div>
                <div class="services-grid">
                    <div class="service-card hw-card" data-name="Montagem de PC" data-price="225.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Montagem de PC</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 225,00</div></div>
                        <div class="real-count-badge" id="badge-Montagem de PC"></div>
                    </div>
                    
                    <div class="service-card hw-card" data-name="Consultoria de Pe√ßas" data-price="35.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Consultoria de Pe√ßas (Setup)</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 35,00</div></div>
                        <span class="badge bg-hw">ECONOMIZE NA COMPRA</span>
                        <div class="real-count-badge" id="badge-Consultoria de Pe√ßas"></div>
                    </div>

                    <div class="service-card hw-card" data-name="Diagn√≥stico Defeito" data-price="50.00" onclick="toggleItem(this)">
                        <div class="card-header"><span class="service-name">Diagn√≥stico Defeito</span><div class="check-circle"></div></div>
                        <div class="price-container"><div class="price-tag">R$ 50,00</div></div>
                        <div class="real-count-badge" id="badge-Diagn√≥stico Defeito"></div>
                    </div>
                </div>
            </div>

            <div class="diagnosis-section" id="diagnosis-section-container">
                <div class="special-title" style="color: var(--danger); margin-bottom: 10px; font-weight:900;">üö® DIAGN√ìSTICO PRELIMINAR</div>
                <div class="symptom-grid">
                    <label class="symptom-item"><input type="checkbox" name="sintoma" value="N√£o Liga" onchange="saveState()"> N√£o Liga</label>
                    <label class="symptom-item"><input type="checkbox" name="sintoma" value="Liga sem Imagem" onchange="saveState()"> Liga sem Imagem</label>
                    <label class="symptom-item"><input type="checkbox" name="sintoma" value="Tela Azul" onchange="saveState()"> Tela Azul</label>
                    <label class="symptom-item"><input type="checkbox" name="sintoma" value="Travando/Lento" onchange="saveState()"> Lento/Travando</label>
                </div>
                <div class="input-group"><textarea id="diagnosis-details" rows="2" placeholder="Descreva o problema..." oninput="saveState()"></textarea></div>
            </div>

            <div class="dream-section" id="dream-section-container">
                <div class="special-title" style="color: var(--dream); margin-bottom: 10px; font-weight:900;">
                    üí≠ PC DOS SONHOS
                </div>
                <div class="dream-grid">
                    <div class="input-group"><label>üí∞ Or√ßamento</label><input type="text" id="dream-budget" placeholder="R$ 0,00" oninput="saveState()"></div>
                    <div class="input-group"><label>üéØ Uso</label><select id="dream-usage" style="background:#000;color:white;border:1px solid #333;padding:14px;border-radius:8px;" onchange="saveState()"><option value="">Selecione...</option><option value="Jogos">Jogos</option><option value="Trabalho">Trabalho</option></select></div>
                </div>
                <div class="input-group"><textarea id="dream-details" rows="2" placeholder="Detalhes..." oninput="saveState()"></textarea></div>
            </div>
            <div class="floating-forward-area">
                <!-- Mudan√ßa de a√ß√£o: Agora vai para agendamento -->
                <button class="btn-primary" onclick="goToSchedule()">SEGUIR PARA AGENDAMENTO ‚ûî</button>
            </div>

        </div> 
        
        <!-- STEP 3: AGENDAMENTO (NOVO) -->
        <div id="step-schedule">
            <div class="schedule-card">
                <div class="schedule-title">
                    <h2>üìÖ Disponibilidade</h2>
                    <p>Selecione os dias e hor√°rios preferenciais para o servi√ßo.</p>
                </div>

                <div class="input-group">
                    <label>Dias da Semana (Pode marcar v√°rios)</label>
                    <div class="days-grid">
                        <div class="day-btn" onclick="toggleDay(this)" data-day="Seg">Segunda</div>
                        <div class="day-btn" onclick="toggleDay(this)" data-day="Ter">Ter√ßa</div>
                        <div class="day-btn" onclick="toggleDay(this)" data-day="Qua">Quarta</div>
                        <div class="day-btn" onclick="toggleDay(this)" data-day="Qui">Quinta</div>
                        <div class="day-btn" onclick="toggleDay(this)" data-day="Sex">Sexta</div>
                        <div class="day-btn" onclick="toggleDay(this)" data-day="S√°b">S√°bado</div>
                        <div class="day-btn" onclick="toggleDay(this)" data-day="Dom">Domingo</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Hor√°rio / Detalhes</label>
                    <textarea id="schedule-details" rows="3" placeholder="Ex: Sexta ap√≥s as 14h, ou S√°bado de manh√£..." oninput="saveState()"></textarea>
                </div>

                <div class="review-actions">
                    <button class="btn-primary" onclick="goToReview()">REVISAR PEDIDO ‚ûî</button>
                    <button class="btn-secondary" onclick="backToMenu()">‚Ü© Voltar para Servi√ßos</button>
                </div>
            </div>
        </div>

        <!-- STEP 4: REVIS√ÉO (ATUALIZADO) -->
        <div id="step-review">
            <div class="review-card">
                <div class="review-header">
                    <h2>Resumo do Pedido</h2>
                    <p>Confira seus servi√ßos antes de enviar.</p>
                </div>
                
                <div class="review-list" id="review-list-container">
                    <!-- Lista gerada via JS -->
                </div>

                <!-- Resumo da Agenda na Revis√£o -->
                <div class="review-schedule-info" id="review-schedule-display">
                    <!-- Preenchido via JS -->
                </div>

                <div class="input-group">
                    <label style="margin-top:20px">Alguma Observa√ß√£o Extra?</label>
                    <textarea id="input-feedback" rows="2" placeholder="Ex: Preciso urgente, prefiro contato √† tarde..." oninput="saveState()"></textarea>
                </div>

                <div class="review-summary">
                    <div class="summary-label">Valor Total Estimado</div>
                    <div class="summary-total" id="review-total-display">R$ 0,00</div>
                    <div id="review-savings" class="summary-savings" style="display:none"></div>
                </div>

                <div class="review-actions">
                    <button class="btn-primary" id="btn-finish" onclick="finishOrder()">CONFIRMAR E ENVIAR üì≤</button>
                    <!-- Link manual de fallback caso o JS falhe no redirect -->
                    <a id="manual-whatsapp-link" href="#" target="_blank" style="display:none; text-decoration:none;">
                         <button class="btn-secondary" style="background:#25D366; border:none; color:white;">
                            WhatsApp n√£o abriu? Clique aqui
                         </button>
                    </a>
                    <button class="btn-secondary" onclick="backToSchedule()">‚Ü© Alterar Agendamento</button>
                </div>
            </div>
        </div>

    </div>

    <div id="demo-modal" class="modal-overlay" onclick="closeDemo(event)">
        <div class="modal-content"><span class="modal-close" onclick="closeDemoExplicit()">√ó</span><h3 id="modal-title" style="margin-bottom:15px;">Demonstra√ß√£o</h3><div id="modal-body"></div></div>
    </div>

    <script>
        const MY_WHATSAPP = "5513998059374"; 
        const SHEET_URL = "https://api.sheetmonkey.io/form/nscyFYxznN7wnU9F4RhVsR";
        const LINK_CSV_PLANILHA = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTvhBhY1TvExozH9_VMp6SLDYgCav9a8TDRoNS17jaUJp8fvp8E3XQQ1spBXGgd2-S0X5IueT8c7GUG/pub?gid=950131635&single=true&output=csv"; 
        
        // CONFIGURA√á√ÉO DO BACKUP
        const BACKUP_PRICE_PER_GB = 5.00; 

        let cart = []; 
        let cartObjects = []; // Guarda infos completas {name, price, type}
        let total = 0; let clientData = {}; let totalSavings = 0;
        let selectedDays = []; // Array para guardar dias selecionados

        const recommendations = {
            'Otimiza√ß√£o Windows': 'Renova√ß√£o Drivers',
            'Renova√ß√£o Drivers': 'Otimiza√ß√£o Windows',
            'Formata√ß√£o Limpa': 'Backup',
            'Montagem de PC': 'Consultoria de Pe√ßas'
        };

        function maskPhone(input) {
            let v = input.value.replace(/\D/g,'');
            v = v.substring(0, 11);
            if (v.length > 10) {
                v = v.replace(/^(\d\d)(\d{5})(\d{4}).*/, "($1) $2-$3");
            } else if (v.length > 5) {
                v = v.replace(/^(\d\d)(\d{4})(\d{0,4}).*/, "($1) $2-$3");
            } else if (v.length > 2) {
                v = v.replace(/^(\d\d)(\d{0,5}).*/, "($1) $2");
            } else {
                v = v.replace(/^(\d*)/, "($1");
            }
            input.value = v;
        }

        async function fetchStats() {
            let globalCount = 0;
            let serviceCounts = {};
            let groupCounts = { 'manutencao': 0, 'performance': 0, 'studio': 0, 'hardware': 0, 'montagem': 0 };

            const counterDisplay = document.getElementById('total-services-count');
            if(counterDisplay) counterDisplay.innerText = "‚è≥"; 

            try {
                const response = await fetch(LINK_CSV_PLANILHA);
                if (!response.ok) throw new Error("Erro HTTP: " + response.status);
                const data = await response.text();
                const rows = data.split(/\r\n|\n/);
                
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (!row || row.trim() === "") continue;
                    
                    const serviceKeywords = [
                        { key: "Formata√ß√£o Limpa", match: "Formata√ß√£o" },
                        { key: "Ativa√ß√£o Windows", match: "Ativa√ß√£o" },
                        { key: "Backup", match: "Backup" },
                        { key: "Instala√ß√£o de Programas", match: "Programas" },
                        { key: "Otimiza√ß√£o Windows", match: "Otimiza√ß√£o" },
                        { key: "Renova√ß√£o Drivers", match: "Drivers" },
                        { key: "Update BIOS", match: "Update BIOS" },
                        { key: "Overclock", match: "Overclock" },
                        { key: "COMBO GAMER TOTAL", match: "GAMER TOTAL" },
                        { key: "Config Microfone", match: "Microfone" },
                        { key: "Calibra√ß√£o Monitor", match: "Calibra√ß√£o" },
                        { key: "Config OBS", match: "OBS" },
                        { key: "COMBO STUDIO PRO", match: "STUDIO PRO" },
                        { key: "Limpeza Premium", match: "Limpeza" },
                        { key: "Organiza√ß√£o de Cabos", match: "Cabos" },
                        { key: "Montagem de PC", match: "Montagem" },
                        { key: "Consultoria de Pe√ßas", match: "Consultoria" },
                        { key: "Diagn√≥stico Defeito", match: "Diagn√≥stico" }
                    ];

                    serviceKeywords.forEach(item => {
                        if (row.toLowerCase().includes(item.match.toLowerCase())) {
                            serviceCounts[item.key] = (serviceCounts[item.key] || 0) + 1;
                            globalCount++;
                        }
                    });
                }

            } catch (e) {
                console.warn("Falha ao buscar planilha. Usando dados simulados.", e);
                const sim = generateSimulatedStats();
                serviceCounts = sim.counts;
                globalCount = sim.total;
            }

            calculateGroups(serviceCounts, groupCounts);
            updateUI(globalCount, serviceCounts, groupCounts);
        }

        function calculateGroups(counts, groups) {
            Object.keys(counts).forEach(key => {
                let val = counts[key];
                if(['Formata√ß√£o Limpa', 'Ativa√ß√£o Windows', 'Backup', 'Instala√ß√£o de Programas'].includes(key)) groups.manutencao += val;
                if(['Otimiza√ß√£o Windows', 'Renova√ß√£o Drivers', 'Update BIOS', 'Overclock', 'COMBO GAMER TOTAL'].includes(key)) groups.performance += val;
                if(['Config Microfone', 'Calibra√ß√£o Monitor', 'Config OBS', 'COMBO STUDIO PRO'].includes(key)) groups.studio += val;
                if(['Limpeza Premium', 'Organiza√ß√£o de Cabos'].includes(key)) groups.hardware += val;
                if(['Montagem de PC', 'Consultoria de Pe√ßas', 'Diagn√≥stico Defeito'].includes(key)) groups.montagem += val;
            });
        }

        function generateSimulatedStats() {
            const counts = {
                "Formata√ß√£o Limpa": 42, "Ativa√ß√£o Windows": 15, "Backup": 8, "Instala√ß√£o de Programas": 5,
                "Otimiza√ß√£o Windows": 58, "Renova√ß√£o Drivers": 23, "Update BIOS": 12, "Overclock": 7, "COMBO GAMER TOTAL": 31,
                "Config Microfone": 18, "Calibra√ß√£o Monitor": 9, "Config OBS": 14, "COMBO STUDIO PRO": 6,
                "Limpeza Premium": 27, "Organiza√ß√£o de Cabos": 11,
                "Montagem de PC": 19, "Consultoria de Pe√ßas": 22, "Diagn√≥stico Defeito": 34
            };
            let total = 0;
            Object.values(counts).forEach(v => total += v);
            return { counts, total };
        }

        function updateUI(global, counts, groups) {
            const globalCounter = document.getElementById('total-services-count');
            if(globalCounter) globalCounter.innerText = global;
            
            const globalDisplay = document.getElementById('global-counter-display');
            if(globalDisplay) globalDisplay.style.opacity = '1';

            const gMap = {
                'manutencao': 'count-group-manutencao', 'performance': 'count-group-performance',
                'studio': 'count-group-studio', 'hardware': 'count-group-hardware', 'montagem': 'count-group-montagem'
            };
            Object.keys(groups).forEach(g => {
                const el = document.getElementById(gMap[g]);
                if(el) el.innerText = groups[g] + ' finalizados';
            });

            Object.keys(counts).forEach(key => {
                const el = document.getElementById(`badge-${key}`);
                if(el) el.innerHTML = `üî• <span>${counts[key]}</span> vendidos`;
            });
        }

        /* --- L√ìGICA DO SLIDER DE BACKUP --- */
        function updateBackupFromSlider(val) {
            // Slider vai de 0 a 100 (representando 0.0 a 10.0)
            const gb = val / 10;
            document.getElementById('backup-manual').value = gb;
            calculateBackupPrice(gb);
        }

        function updateBackupFromInput(val) {
            let gb = parseFloat(val);
            if(isNaN(gb)) gb = 0;
            if(gb > 10) gb = 10;
            // Sincroniza slider (0-100)
            document.getElementById('backup-slider').value = gb * 10;
            calculateBackupPrice(gb);
        }

        function calculateBackupPrice(gb) {
            const newPrice = gb * BACKUP_PRICE_PER_GB;
            const display = document.getElementById('backup-price-display');
            const card = document.getElementById('card-backup');
            
            // Atualiza display visual
            display.innerText = `R$ ${newPrice.toFixed(2).replace('.', ',')}`;
            
            // Verifica se houve mudan√ßa de pre√ßo enquanto selecionado
            const oldPrice = parseFloat(card.getAttribute('data-price'));
            card.setAttribute('data-price', newPrice.toFixed(2));
            card.setAttribute('data-name', `Backup (${gb}GB)`);

            // Se o card j√° estiver selecionado no carrinho, precisamos atualizar o total global
            if (card.classList.contains('selected')) {
                // Remove o pre√ßo antigo do total e adiciona o novo
                total = total - oldPrice + newPrice;
                
                // Atualiza o objeto no carrinho
                const cartIndex = cartObjects.findIndex(c => c.name.includes("Backup"));
                if (cartIndex !== -1) {
                    cartObjects[cartIndex].price = newPrice;
                    cartObjects[cartIndex].name = `Backup (${gb}GB)`;
                    cart[cartIndex] = `Backup (${gb}GB)`;
                }
                
                // Salva estado novo
                saveState();
            }
        }

        function toggleDay(el) {
            const day = el.getAttribute('data-day');
            if(selectedDays.includes(day)) {
                selectedDays = selectedDays.filter(d => d !== day);
                el.classList.remove('selected');
            } else {
                selectedDays.push(day);
                el.classList.add('selected');
            }
            triggerHaptic();
            saveState();
        }

        // --- CORRE√á√ÉO DE SEGURAN√áA NO SAVESTATE ---
        function getSafeValue(id) {
            const el = document.getElementById(id);
            return el ? el.value : "";
        }

        function saveState() {
            const state = {
                cart: cart,
                total: total,
                selectedDays: selectedDays,
                inputs: {
                    name: getSafeValue('input-name'),
                    phone: getSafeValue('input-phone'),
                    dreamBudget: getSafeValue('dream-budget'),
                    dreamUsage: getSafeValue('dream-usage'),
                    dreamDetails: getSafeValue('dream-details'),
                    diagDetails: getSafeValue('diagnosis-details'),
                    feedback: getSafeValue('input-feedback'),
                    scheduleDetails: getSafeValue('schedule-details')
                },
                checkboxes: Array.from(document.querySelectorAll('input[name="sintoma"]:checked')).map(cb => cb.value)
            };
            localStorage.setItem('tech7b_state', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('tech7b_state');
            if (!saved) return;
            
            try {
                const state = JSON.parse(saved);
                
                if(state.inputs) {
                    if(document.getElementById('input-name')) document.getElementById('input-name').value = state.inputs.name || "";
                    if(document.getElementById('input-phone')) document.getElementById('input-phone').value = state.inputs.phone || "";
                    if(document.getElementById('dream-budget')) document.getElementById('dream-budget').value = state.inputs.dreamBudget || "";
                    if(document.getElementById('dream-usage')) document.getElementById('dream-usage').value = state.inputs.dreamUsage || "";
                    if(document.getElementById('dream-details')) document.getElementById('dream-details').value = state.inputs.dreamDetails || "";
                    if(document.getElementById('diagnosis-details')) document.getElementById('diagnosis-details').value = state.inputs.diagDetails || "";
                    if(document.getElementById('input-feedback')) document.getElementById('input-feedback').value = state.inputs.feedback || "";
                    if(document.getElementById('schedule-details')) document.getElementById('schedule-details').value = state.inputs.scheduleDetails || "";
                }

                if(state.checkboxes) {
                    state.checkboxes.forEach(val => {
                        const cb = document.querySelector(`input[name="sintoma"][value="${val}"]`);
                        if(cb) cb.checked = true;
                    });
                }
                
                if(state.selectedDays) {
                    selectedDays = state.selectedDays;
                    selectedDays.forEach(day => {
                        const el = document.querySelector(`.day-btn[data-day="${day}"]`);
                        if(el) el.classList.add('selected');
                    });
                }

                if (state.inputs.name && state.inputs.name.length > 2 && state.inputs.phone && state.inputs.phone.length > 10) {
                    clientData = { name: state.inputs.name, phone: state.inputs.phone };
                    // Atualiza Barra de Progresso e vai pro Menu
                    document.getElementById('step-identity').style.display='none';
                    document.getElementById('step-menu').style.display='block';
                    updateProgressStep(2);
                }

                if (state.cart && state.cart.length > 0) {
                    cart = []; total = 0; totalSavings = 0; cartObjects = [];
                    const cards = document.querySelectorAll('.service-card');
                    cards.forEach(card => {
                        const cardName = card.getAttribute('data-name'); 
                        // Verifica se √© backup (nome din√¢mico) ou outro item
                        const isBackupInCart = state.cart.some(s => s.includes("Backup") && cardName.includes("Backup"));
                        
                        if (isBackupInCart) {
                             // Tenta extrair GB do nome salvo ex: "Backup (5.5GB)"
                             const savedItem = state.cart.find(s => s.includes("Backup"));
                             const match = savedItem.match(/Backup \(([\d.]+)GB\)/);
                             if(match) {
                                 const gb = match[1];
                                 document.getElementById('backup-manual').value = gb;
                                 updateBackupFromInput(gb); // Recalcula pre√ßo antes de clicar
                             }
                             card.click();
                        }
                        else if (state.cart.some(s => s === cardName)) {
                            card.click(); 
                        }
                    });
                }

            } catch (e) {
                console.error("Erro ao carregar estado:", e);
                localStorage.removeItem('tech7b_state'); 
            }
        }

        window.addEventListener('load', () => {
            loadState();
            fetchStats();
        });

        function updateProgressStep(step) {
            const s1 = document.getElementById('step-1-indicator');
            const s2 = document.getElementById('step-2-indicator');
            const s3 = document.getElementById('step-3-indicator'); // Agenda
            const s4 = document.getElementById('step-4-indicator'); // Revis√£o
            const fill = document.getElementById('progress-fill');
            
            // Lista de todos os passos para contagem autom√°tica
            const allSteps = [s1, s2, s3, s4];
            const totalSteps = allSteps.length;

            // F√ìRMULA UNIVERSAL DE PROGRESSO
            // (stepAtual - 1) / (total - 1) * 100
            const activeIndex = step - 1;
            const percent = (activeIndex / (totalSteps - 1)) * 100;
            
            fill.style.width = percent + "%";

            // Atualiza as classes visuais (Cores)
            allSteps.forEach((stepEl, index) => {
                stepEl.classList.remove('active', 'completed');
                
                if (index < activeIndex) {
                    stepEl.classList.add('completed');
                } else if (index === activeIndex) {
                    stepEl.classList.add('active');
                }
            });
        }

        function triggerHaptic() {
            if (navigator.vibrate) {
                navigator.vibrate(15); 
            }
        }

        function goToMenu() {
            const nameInput = document.getElementById('input-name');
            const phoneInput = document.getElementById('input-phone');
            
            if(!nameInput || !phoneInput) return; 

            const name = nameInput.value;
            const phone = phoneInput.value;

            if(name.length < 3 || phone.length < 13) { alert("Por favor, preencha seu Nome e WhatsApp corretamente."); return; }
            clientData = { name, phone };
            
            saveState();
            triggerHaptic();
            updateProgressStep(2);

            document.getElementById('step-identity').style.display='none'; 
            document.getElementById('step-menu').style.display='block'; 
            window.scrollTo(0,0);
        }

        // NOVO: Vai do Menu para Agenda
        function goToSchedule() {
            if (cart.length === 0) { alert("Por favor, selecione ao menos um servi√ßo."); return; }
            triggerHaptic();
            saveState();
            
            document.getElementById('step-menu').style.display = 'none';
            document.getElementById('step-schedule').style.display = 'block';
            updateProgressStep(3);
            window.scrollTo(0,0);
        }

        // ALTERADO: Volta da Agenda para Menu
        function backToMenu() {
            triggerHaptic();
            document.getElementById('step-schedule').style.display = 'none';
            document.getElementById('step-menu').style.display = 'block';
            updateProgressStep(2);
            window.scrollTo(0, document.body.scrollHeight);
        }

        // NOVO: Vai da Agenda para Revis√£o
        function goToReview() {
            // Valida√ß√£o opcional da agenda
            // if(selectedDays.length === 0) { alert("Selecione pelo menos um dia."); return; }
            
            triggerHaptic();
            saveState();
            
            const listContainer = document.getElementById('review-list-container');
            listContainer.innerHTML = ''; 

            cartObjects.forEach(item => {
                const div = document.createElement('div');
                div.className = `review-item ${item.type === 'sw' ? 'type-sw' : 'type-hw'}`;
                div.innerHTML = `
                    <div class="review-item-name">${item.name}</div>
                    <div class="review-item-price">R$ ${item.price.toFixed(2).replace('.',',')}</div>
                `;
                listContainer.appendChild(div);
            });

            // Mostra resumo da agenda
            const schedDisplay = document.getElementById('review-schedule-display');
            const schedDetails = document.getElementById('schedule-details').value;
            let daysText = selectedDays.length > 0 ? selectedDays.join(', ') : "A combinar";
            
            schedDisplay.innerHTML = `<div>üìÖ <span>${daysText}</span></div>`;
            if(schedDetails) {
                 schedDisplay.innerHTML += `<div style="margin-left:10px;border-left:1px solid #444;padding-left:10px;font-style:italic">"${schedDetails}"</div>`;
            }

            // Atualiza totais na tela de revis√£o
            document.getElementById('review-total-display').innerText = `R$ ${total.toFixed(2).replace('.', ',')}`;
            
            const savingsEl = document.getElementById('review-savings');
            if (totalSavings > 0) {
                savingsEl.style.display = 'inline-block';
                savingsEl.innerText = `Voc√™ economizou R$ ${totalSavings.toFixed(2).replace('.', ',')}`;
            } else {
                savingsEl.style.display = 'none';
            }

            // Troca de tela
            document.getElementById('step-schedule').style.display = 'none';
            document.getElementById('step-review').style.display = 'block';
            updateProgressStep(4);
            window.scrollTo(0,0);
        }
        
        function backToSchedule() {
            triggerHaptic();
            document.getElementById('step-review').style.display = 'none';
            document.getElementById('step-schedule').style.display = 'block';
            updateProgressStep(3);
        }

        function toggleItem(el) {
            triggerHaptic();

            const name = el.getAttribute('data-name');
            const price = parseFloat(el.getAttribute('data-price'));
            const fullPrice = parseFloat(el.getAttribute('data-full-price')); 
            const isSw = el.classList.contains('sw-card');
            const type = isSw ? 'sw' : 'hw';

            if (!name || isNaN(price)) { console.error("Erro no card", el); return; }

            if(el.classList.contains('selected')) {
                el.classList.remove('selected'); 
                total -= price; 
                
                // Remove item do array de nomes
                // Para o backup, o nome pode variar, ent√£o filtramos por includes se for backup
                if (name.includes("Backup")) {
                    cart = cart.filter(i => !i.includes("Backup"));
                    cartObjects = cartObjects.filter(i => !i.name.includes("Backup"));
                } else {
                    cart = cart.filter(i => i !== name);
                    cartObjects = cartObjects.filter(i => i.name !== name);
                }
                
                if(!isNaN(fullPrice)) { totalSavings -= (fullPrice - price); }
                
                if(name === 'Consultoria de Pe√ßas') document.getElementById('dream-section-container').style.display = 'none';
                if(name === 'Diagn√≥stico Defeito') document.getElementById('diagnosis-section-container').style.display = 'none';
            } else {
                el.classList.add('selected'); 
                total += price; 
                cart.push(name);
                cartObjects.push({name, price, type}); // Adiciona info extra

                if(!isNaN(fullPrice)) { totalSavings += (fullPrice - price); }
                
                if(name === 'Consultoria de Pe√ßas') { 
                    const sec = document.getElementById('dream-section-container'); 
                    sec.style.display = 'block'; 
                    setTimeout(() => sec.scrollIntoView({ behavior: 'smooth', block: 'center' }), 200); 
                }
                if(name === 'Diagn√≥stico Defeito') { 
                    const sec = document.getElementById('diagnosis-section-container'); 
                    sec.style.display = 'block'; 
                    setTimeout(() => sec.scrollIntoView({ behavior: 'smooth', block: 'center' }), 200); 
                }
                
                checkRecommendation(name);
            }
            
            saveState();
        }

        function checkRecommendation(selectedName) {
            Object.keys(recommendations).forEach(trigger => {
                if (selectedName.includes(trigger)) { 
                    const targetName = recommendations[trigger];
                    const targetInCart = cart.some(item => item.includes(targetName.split(' ')[0])); 

                    if (!targetInCart) {
                        showToast(`Quem leva <b>${selectedName}</b> costuma levar <b>${targetName}</b> tamb√©m!`);
                        highlightCard(targetName);
                    }
                }
            });
        }

        function showToast(msg) {
            const toast = document.getElementById('toast-notification');
            const toastMsg = document.getElementById('toast-msg');
            toastMsg.innerHTML = msg;
            toast.style.display = 'block';
            if(navigator.vibrate) navigator.vibrate([30, 50, 30]); 
            setTimeout(() => { toast.style.display = 'none'; }, 5000);
        }

        function highlightCard(partialName) {
            const cards = document.querySelectorAll('.service-card');
            cards.forEach(card => {
                if(card.innerText.includes(partialName)) {
                    card.classList.add('recommended-pulse');
                    setTimeout(() => card.classList.remove('recommended-pulse'), 3000);
                }
            });
        }

        async function finishOrder() {
            triggerHaptic();

            const feedback = document.getElementById('input-feedback').value;
            const dreamBudget = document.getElementById('dream-budget').value; 
            const dreamUsage = document.getElementById('dream-usage').value; 
            const dreamDetails = document.getElementById('dream-details').value;
            const schedDetails = document.getElementById('schedule-details').value;
            
            let diagnosisList = []; 
            document.querySelectorAll('input[name="sintoma"]:checked').forEach(cb => diagnosisList.push(cb.value)); 
            const diagnosisDetails = document.getElementById('diagnosis-details').value;

            const btn = document.getElementById('btn-finish'); 
            btn.innerHTML = "ENVIANDO..."; 
            btn.disabled = true;
            
            // --- CONSTRU√á√ÉO DOS DADOS ---
            const now = new Date(); const orderID = "#" + now.getDate() + now.getHours() + Math.floor(Math.random()*100);
            const dateStr = "'" + now.toLocaleDateString('pt-BR') + ' ' + now.toLocaleTimeString('pt-BR');

            const daysStr = selectedDays.length > 0 ? selectedDays.join(', ') : "A combinar";
            const scheduleFinal = `Dias: ${daysStr} | Obs: ${schedDetails}`;

            let fullObs = feedback;
            if(cart.includes('Consultoria de Pe√ßas') && (dreamUsage || dreamDetails)) fullObs += ` | [PC SONHOS]: ${dreamBudget} - ${dreamUsage} - ${dreamDetails}`;
            if(cart.includes('Diagn√≥stico Defeito') && (diagnosisList.length > 0 || diagnosisDetails)) fullObs += ` | [DIAGN√ìSTICO]: ${diagnosisList.join(', ')} - ${diagnosisDetails}`;
            fullObs += ` | [AGENDA]: ${scheduleFinal}`;

            const data = { 
                "Data": dateStr, "ID": orderID, "Cliente": clientData.name, 
                "Telefone": clientData.phone, "Servicos": cart.join(" | "), 
                "Total": `R$ ${total.toFixed(2).replace('.', ',')}`, "Observacoes": fullObs 
            };

            // --- CONSTRU√á√ÉO DO LINK DO WHATSAPP ---
            let msgZap = `Ol√°! Fiz o *Pedido ${orderID}*.\nüë§ *${clientData.name}*\nüí∞ *Total:* R$ ${total.toFixed(2).replace('.', ',')}\n\nüõí *Servi√ßos:* \n${cart.join('\n')}\n`;
            if(cart.includes('Consultoria de Pe√ßas')) msgZap += `\nüí≠ *PC SONHOS:* ${dreamUsage} (${dreamBudget})\n`;
            if(cart.includes('Diagn√≥stico Defeito')) msgZap += `\nüö® *SINTOMAS:* ${diagnosisList.join(', ')}\n`;
            
            msgZap += `\nüìÖ *Disponibilidade:* ${daysStr}`;
            if(schedDetails) msgZap += `\nüïí *Obs Hor√°rio:* ${schedDetails}`;
            if(feedback) msgZap += `\nüìù *Obs:* ${feedback}`;

            if(totalSavings > 0) msgZap += `\n\nü§ë *Economizei:* R$ ${totalSavings.toFixed(2).replace('.', ',')}\n`;
            msgZap += `\nAguardo retorno!`;

            const linkZap = `https://wa.me/${MY_WHATSAPP}?text=${encodeURIComponent(msgZap)}`;
            
            // Link de backup (caso o autom√°tico falhe)
            document.getElementById('manual-whatsapp-link').href = linkZap;
            document.getElementById('manual-whatsapp-link').style.display = 'block';

            // --- ENVIO PARA PLANILHA E REDIRECIONAMENTO ---
            try {
                // Tenta enviar para a planilha
                await fetch(SHEET_URL, { 
                    method: 'POST', 
                    headers: {'Content-Type': 'application/json'}, 
                    body: JSON.stringify(data) 
                });
            } catch (e) {
                console.error("Erro planilha (background):", e);
                // Mesmo com erro na planilha, segue para o WhatsApp
            } finally {
                // Remove estado local
                localStorage.removeItem('tech7b_state');
                
                // Feedback visual
                btn.innerHTML = "ENVIADO! ‚úÖ";
                
                // REDIRECIONAMENTO SEGURO
                // Usamos location.href em vez de window.open para evitar bloqueadores de popup
                // e garantir que funcione bem em celulares (deep link)
                window.location.href = linkZap;

                // Recarrega a p√°gina ap√≥s um tempo maior para dar tempo do redirect acontecer
                setTimeout(() => window.location.reload(), 4000);
            }
        }

        function openDemo(event, type) {
            triggerHaptic();
            event.stopPropagation(); const modal = document.getElementById('demo-modal'); const title = document.getElementById('modal-title'); const body = document.getElementById('modal-body');
            title.style.color = "var(--primary)"; modal.style.display = 'flex';
            if (type === 'mic') { title.innerText = "üéôÔ∏è Mic Test"; body.innerHTML = `<div class="audio-box"><span>‚ùå ANTES:</span><audio controls style="width:100%" src="mic_antes.mp3"></audio></div><div class="audio-box" style="border-color:var(--primary)"><span>‚úÖ DEPOIS:</span><audio controls style="width:100%" src="mic_depois.mp3"></audio></div>`; } 
            else if (type === 'fps') { title.innerText = "üöÄ FPS Boost"; body.innerHTML = `<video class="demo-video" controls autoplay loop muted><source src="fps_demo.mp4" type="video/mp4"></video><div style="display:flex;justify-content:space-between;margin-top:10px"><span>Antes: ~45</span><span style="color:var(--primary)">Depois: ~120</span></div>`; }
            else if (type === 'color') { title.innerText = "üé® Cores"; body.innerHTML = `<img class="demo-video" src="cores_demo.jpg" alt="Compara√ß√£o de cores"><p style="margin-top:10px"></p>`; }
        }
        function openWarning(event) {
            triggerHaptic();
            event.stopPropagation(); document.getElementById('demo-modal').style.display='flex'; 
            document.getElementById('modal-title').innerText="‚ö†Ô∏è Aviso Cor"; document.getElementById('modal-title').style.color="#ff9d00";
            document.getElementById('modal-body').innerHTML = `<p style="color:#ccc;text-align:left">A c√¢mera n√£o capta o que o olho v√™. A foto pode parecer escura ou saturada, mas ao vivo a calibra√ß√£o √© perfeita para o padr√£o sRGB.</p><button onclick="closeDemoExplicit()" style="margin-top:20px;width:100%;padding:10px;background:#333;color:white;border:none;border-radius:5px;cursor:pointer">Entendi</button>`;
        }
        function closeDemo(event) { if (event.target.id === 'demo-modal') closeDemoExplicit(); }
        function closeDemoExplicit() { document.getElementById('demo-modal').style.display = 'none'; document.getElementById('modal-body').innerHTML = ''; }
    </script>
</body>
</html>

